<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<title>Neon Cyberpunk Lines â€“ Mobile</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');
  :root{
    --bg:#0d0d1a;
    --grid:#1a1a2e;
    --neon-cyan:#00f5ff;
    --neon-purple:#9d00ff;
    --neon-pink:#ff00ff;
    --neon-lime:#39ff14;
    --neon-orange:#ff5e00;
    --neon-blue:#007bff;
    --text:#ffffff;
  }
  
  * {
    box-sizing: border-box;
  }
  
  html,body{
    height:100vh;
    margin:0;
    padding:0;
    background:var(--bg);
    color:var(--text);
    font-family:'Orbitron',monospace;
    user-select:none;
    overflow-x:hidden;
    -webkit-tap-highlight-color: transparent;
  }
  
  body {
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    padding: 10px;
  }
  
  #gameContainer{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:12px;
    width:100%;
    max-width:400px;
    height:100vh;
    justify-content:center;
    padding:10px;
  }
  
  /* Game Board */
  #gameBoard{
    display:grid;
    grid-template-columns:repeat(9,1fr);
    grid-template-rows:repeat(9,1fr);
    gap:2px;
    background:var(--grid);
    padding:6px;
    border:2px solid var(--neon-cyan);
    box-shadow:0 0 20px var(--neon-cyan),inset 0 0 20px rgba(0,245,255,0.1);
    border-radius:8px;
    width:min(80vw, 320px);
    height:min(80vw, 320px);
    aspect-ratio:1;
    position:relative;
  }
  
  .cell{
    background:linear-gradient(135deg, #0f0f1f, #1a1a2e);
    position:relative;
    border-radius:3px;
    min-height:0;
    aspect-ratio:1;
    border:1px solid rgba(157,0,255,0.1);
  }
  
  .ball{
    position:absolute;
    top:50%;
    left:50%;
    width:75%;
    height:75%;
    border-radius:50%;
    transform:translate(-50%,-50%) scale(1);
    box-shadow:0 0 10px currentColor,0 0 20px currentColor,inset 0 0 10px rgba(255,255,255,0.1);
    transition:transform .3s ease,opacity .3s ease;
    background:radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3), transparent 50%);
    background-color:currentColor;
  }
  
  .ball.selected{
    transform:translate(-50%,-50%) scale(1.15);
    box-shadow:0 0 15px currentColor,0 0 30px currentColor,0 0 45px currentColor;
    animation:pulse 1s infinite;
  }
  
  @keyframes pulse{
    0%,100%{transform:translate(-50%,-50%) scale(1.15);}
    50%{transform:translate(-50%,-50%) scale(1.25);}
  }
  
  .ball.removing{
    transform:translate(-50%,-50%) scale(0);
    opacity:0;
  }
  
  @keyframes growIn{
    from{transform:translate(-50%,-50%) scale(0) rotate(180deg);opacity:0;}
    to{transform:translate(-50%,-50%) scale(1) rotate(0deg);opacity:1;}
  }
  .ball.new{animation:growIn .4s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;}
  
  /* UI Layout */
  #ui{
    display:grid;
    grid-template-columns:1fr 1fr 1fr;
    gap:8px;
    width:100%;
    max-width:320px;
  }
  
  /* Panels */
  .panel{
    background:linear-gradient(135deg, #0f0f1f, #1a1a2e);
    padding:10px 8px;
    border:1px solid var(--neon-purple);
    border-radius:8px;
    box-shadow:0 0 15px rgba(157,0,255,0.3),inset 0 0 10px rgba(157,0,255,0.05);
    text-align:center;
    position:relative;
    overflow:hidden;
  }
  
  .panel::before{
    content:'';
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:2px;
    background:linear-gradient(90deg, transparent, var(--neon-purple), transparent);
    opacity:0.6;
  }
  
  .panel h2{
    margin:0 0 8px;
    font-size:0.7em;
    color:var(--neon-purple);
    text-transform:uppercase;
    letter-spacing:1px;
    text-shadow:0 0 5px var(--neon-purple);
  }
  
  /* Score Panel */
  .score-panel {
    grid-column:1;
  }
  
  #score {
    font-size:1.4em;
    font-weight:bold;
    color:var(--neon-cyan);
    text-shadow:0 0 10px var(--neon-cyan);
    margin-bottom:8px;
  }
  
  /* Mode Panel */
  .mode-panel {
    grid-column:2;
  }
  
  .mode-buttons {
    display:flex;
    flex-direction:column;
    gap:4px;
  }
  
  /* Next Panel */
  .next-panel {
    grid-column:3;
  }
  
  #preview{
    display:flex;
    gap:4px;
    justify-content:center;
    align-items:center;
  }
  
  .preview-ball{
    width:18px;
    height:18px;
    border-radius:50%;
    box-shadow:0 0 8px currentColor,0 0 12px currentColor;
    background:radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3), transparent 50%);
    background-color:currentColor;
  }
  
  /* Buttons */
  button{
    background:linear-gradient(135deg, transparent, rgba(0,245,255,0.1));
    color:var(--neon-cyan);
    border:1px solid var(--neon-cyan);
    padding:6px 8px;
    border-radius:6px;
    cursor:pointer;
    transition:all .3s ease;
    font-family:'Orbitron',monospace;
    font-size:0.65em;
    min-height:28px;
    touch-action:manipulation;
    text-transform:uppercase;
    letter-spacing:0.5px;
    position:relative;
    overflow:hidden;
  }
  
  button::before{
    content:'';
    position:absolute;
    top:0;
    left:-100%;
    width:100%;
    height:100%;
    background:linear-gradient(90deg, transparent, rgba(0,245,255,0.2), transparent);
    transition:left .5s ease;
  }
  
  button:hover::before, button:active::before{
    left:100%;
  }
  
  button:hover, button:active{
    background:var(--neon-cyan);
    color:var(--bg);
    box-shadow:0 0 15px var(--neon-cyan);
    transform:translateY(-1px);
  }
  
  button.active{
    background:var(--neon-cyan);
    color:var(--bg);
    box-shadow:0 0 10px var(--neon-cyan);
  }
  
  .small-btn {
    font-size:0.6em;
    padding:4px 6px;
    min-height:24px;
  }
  
  /* Control Buttons */
  .controls {
    display:flex;
    gap:8px;
    width:100%;
    max-width:320px;
    margin-top:4px;
  }
  
  #newGameBtn {
    flex:2;
    background:linear-gradient(135deg, rgba(255,94,0,0.1), transparent);
    border-color:var(--neon-orange);
    color:var(--neon-orange);
    font-size:0.75em;
    padding:8px;
    text-shadow:0 0 5px var(--neon-orange);
  }
  
  #newGameBtn:hover, #newGameBtn:active{
    background:var(--neon-orange);
    color:var(--bg);
    box-shadow:0 0 15px var(--neon-orange);
  }
  
  #hsBtn {
    flex:1;
    background:linear-gradient(135deg, rgba(255,0,255,0.1), transparent);
    border-color:var(--neon-pink);
    color:var(--neon-pink);
    font-size:0.7em;
  }
  
  #hsBtn:hover, #hsBtn:active{
    background:var(--neon-pink);
    color:var(--bg);
    box-shadow:0 0 15px var(--neon-pink);
  }
  
  /* High-Score Modal */
  #hsModal{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,.9);
    display:none;
    justify-content:center;
    align-items:center;
    z-index:999;
    padding:20px;
  }
  
  #hsBox{
    background:#111;
    border:2px solid var(--neon-pink);
    padding:20px;
    border-radius:8px;
    max-height:80vh;
    overflow-y:auto;
    width:100%;
    max-width:300px;
    text-align:center;
  }
  
  #hsBox h2{
    color:var(--neon-pink);
    margin-top:0;
    font-size:1.2em;
  }
  
  #hsList{
    list-style:none;
    padding:0;
    margin:0 0 15px;
  }
  
  #hsList li{
    margin:6px 0;
    font-size:0.9em;
    padding:4px;
    border-bottom:1px solid #333;
  }
  
  /* iPhone specific optimizations */
  @media screen and (max-width: 480px) {
    body {
      padding: 5px;
    }
    
    #gameContainer {
      gap: 8px;
      padding: 5px;
    }
    
    #gameBoard {
      width: min(85vw, 300px);
      height: min(85vw, 300px);
      padding: 4px;
    }
    
    #ui {
      max-width: 300px;
      gap: 6px;
    }
    
    .panel {
      padding: 8px 6px;
    }
    
    .panel h2 {
      font-size: 0.65em;
      margin-bottom: 6px;
    }
    
    #score {
      font-size: 1.2em;
    }
    
    .preview-ball {
      width: 16px;
      height: 16px;
    }
    
    button {
      font-size: 0.6em;
      padding: 4px 6px;
      min-height: 26px;
    }
    
    .small-btn {
      font-size: 0.55em;
      padding: 3px 4px;
      min-height: 22px;
    }
    
    .controls {
      max-width: 300px;
      gap: 6px;
    }
    
    #newGameBtn {
      font-size: 0.7em;
      padding: 6px;
    }
    
    #hsBtn {
      font-size: 0.65em;
    }
  }
  
  /* iPhone SE and smaller screens */
  @media screen and (max-width: 375px) {
    #gameBoard {
      width: min(88vw, 280px);
      height: min(88vw, 280px);
    }
    
    #ui {
      max-width: 280px;
      gap: 4px;
    }
    
    .panel {
      padding: 6px 4px;
    }
    
    .panel h2 {
      font-size: 0.6em;
      margin-bottom: 4px;
    }
    
    #score {
      font-size: 1.1em;
    }
    
    .preview-ball {
      width: 14px;
      height: 14px;
    }
    
    button {
      font-size: 0.55em;
      padding: 3px 4px;
      min-height: 24px;
    }
    
    .small-btn {
      font-size: 0.5em;
      padding: 2px 3px;
      min-height: 20px;
    }
    
    .controls {
      max-width: 280px;
    }
    
    #newGameBtn {
      font-size: 0.65em;
    }
    
    #hsBtn {
      font-size: 0.6em;
    }
  }
  
  /* Landscape orientation on phones */
  @media screen and (max-height: 500px) and (orientation: landscape) {
    body {
      padding: 2px;
    }
    
    #gameContainer {
      flex-direction: row;
      gap: 8px;
      justify-content: center;
      align-items: center;
      height: 100vh;
      padding: 2px;
    }
    
    #gameBoard {
      width: min(60vh, 250px);
      height: min(60vh, 250px);
    }
    
    .game-info {
      display: flex;
      flex-direction: column;
      gap: 8px;
      width: 150px;
    }
    
    #ui {
      display: flex;
      flex-direction: column;
      max-width: 150px;
      gap: 4px;
    }
    
    .panel {
      padding: 4px 6px;
    }
    
    .controls {
      flex-direction: column;
      max-width: 150px;
      gap: 4px;
    }
    
    .mode-buttons {
      flex-direction: row;
      gap: 2px;
    }
  }
  
  /* Landscape orientation on phones */
  @media screen and (max-height: 500px) and (orientation: landscape) {
    body {
      padding: 2px;
    }
    
    #gameContainer {
      flex-direction: row;
      gap: 10px;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    
    #gameBoard {
      width: min(70vh, 280px);
      height: min(70vh, 280px);
    }
    
    #ui {
      flex-direction: column;
      max-width: 150px;
      gap: 8px;
    }
    
    .panel {
      width: 100%;
    }
    
    #newGameBtn {
      max-width: 150px;
    }
  }
</style>
</head>
<body>
  <div id="gameContainer">
    <div id="gameBoard"></div>
    
    <div class="game-info">
      <div id="ui">
        <div class="panel score-panel">
          <h2>Score</h2>
          <div id="score">0</div>
        </div>
        
        <div class="panel mode-panel">
          <h2>Mode</h2>
          <div class="mode-buttons">
            <button id="classicBtn" class="active small-btn">Classic</button>
            <button id="squareBtn" class="small-btn">Squares</button>
          </div>
        </div>
        
        <div class="panel next-panel">
          <h2>Next</h2>
          <div id="preview"></div>
        </div>
      </div>
      
      <div class="controls">
        <button id="newGameBtn">New Game</button>
        <button id="hsBtn">Scores</button>
      </div>
    </div>
  </div>

  <!-- High-Score Modal -->
  <div id="hsModal">
    <div id="hsBox">
      <h2>Top 10 Scores</h2>
      <ul id="hsList"></ul>
      <button onclick="closeModal()">Close</button>
    </div>
  </div>

<script>
/* ========== CONFIG ========== */
const SIZE = 9;
const COLORS = ["var(--neon-cyan)","var(--neon-purple)","var(--neon-pink)","var(--neon-lime)","var(--neon-orange)","var(--neon-blue)"];
const MIN_LINE   = 5;
const MIN_SQUARE = 4;

/* ========== STATE ========== */
let mode = 'classic';
let grid = [];
let selected = null;
let score = 0;
let nextBalls = [];
let animating = false;

/* ========== BOARD & DOM ========== */
const boardEl   = document.getElementById('gameBoard');
const scoreEl   = document.getElementById('score');
const modal     = document.getElementById('hsModal');

/* ========== INIT ========== */
initBoard();
renderBoard();
generateNextBalls();
loadHighScores();

/* ========== EVENTS ========== */
boardEl.addEventListener('click', handleClick);
boardEl.addEventListener('touchstart', handleTouch, {passive: true});
document.getElementById('classicBtn').addEventListener('click', ()=>setMode('classic'));
document.getElementById('squareBtn').addEventListener('click', ()=>setMode('squares'));
document.getElementById('newGameBtn').addEventListener('click', newGame);
document.getElementById('hsBtn').addEventListener('click', showHighScores);

/* ========== TOUCH HANDLING ========== */
function handleTouch(e) {
  // Prevent default to avoid double-tap zoom
  e.preventDefault();
  // The click event will still fire, so we don't need additional logic here
}

/* ========== HIGH-SCORE TABLE ========== */
function loadHighScores(){
  return JSON.parse(localStorage.getItem('neonLinesScores') || '[]');
}
function saveScore(s){
  const list = loadHighScores();
  list.push({date:new Date().toLocaleDateString(), score:s});
  list.sort((a,b)=>b.score-a.score);
  localStorage.setItem('neonLinesScores', JSON.stringify(list.slice(0,10)));
}
function showHighScores(){
  const list = loadHighScores();
  const ul = document.getElementById('hsList');
  ul.innerHTML='';
  if(list.length===0) ul.innerHTML='<li>No scores yet</li>';
  else list.forEach((e,i)=>ul.innerHTML+=`<li>${i+1}. ${e.score} â€“ ${e.date}</li>`);
  modal.style.display='flex';
}
function closeModal(){ modal.style.display='none'; }

/* ========== GAME LOGIC ========== */
function initBoard(){
  grid = Array.from({length:SIZE},()=>Array(SIZE).fill(null));
}
function renderBoard(){
  boardEl.innerHTML='';
  for(let r=0;r<SIZE;r++){
    for(let c=0;c<SIZE;c++){
      const cell = document.createElement('div');
      cell.className='cell';
      cell.dataset.r=r; cell.dataset.c=c;
      if(grid[r][c]!==null){
        const ball = document.createElement('div');
        ball.className='ball';
        ball.style.backgroundColor = COLORS[grid[r][c]];
        ball.style.color = COLORS[grid[r][c]];
        cell.appendChild(ball);
      }
      boardEl.appendChild(cell);
    }
  }
}
function generateNextBalls(){
  nextBalls = Array.from({length:3},()=>Math.floor(Math.random()*COLORS.length));
  const previewEl = document.getElementById('preview');
  previewEl.innerHTML='';
  nextBalls.forEach(color=>{
    const d=document.createElement('div');
    d.className='preview-ball';
    d.style.backgroundColor=COLORS[color];
    d.style.color=COLORS[color];
    previewEl.appendChild(d);
  });
}
function placeBallWithAnim(r,c,colorIndex){
  grid[r][c]=colorIndex;
  const cell = document.querySelector(`.cell[data-r="${r}"][data-c="${c}"]`);
  const ball = document.createElement('div');
  ball.className='ball new';
  ball.style.backgroundColor = COLORS[colorIndex];
  ball.style.color = COLORS[colorIndex];
  cell.appendChild(ball);
  setTimeout(()=>ball.classList.remove('new'),250);
}
function addBalls(){
  const empties=[];
  for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++)if(grid[r][c]===null)empties.push([r,c]);
  if(empties.length===0){ gameOver(); return; }
  const count = Math.min(3,empties.length);
  for(let i=0;i<count;i++){
    const idx=Math.floor(Math.random()*empties.length);
    const [r,c]=empties.splice(idx,1)[0];
    placeBallWithAnim(r,c,nextBalls[i]);
  }
  generateNextBalls();
}
function handleClick(e){
  if(animating) return;
  const cell=e.target.closest('.cell');
  if(!cell) return;
  const r=+cell.dataset.r, c=+cell.dataset.c;

  if(selected){
    const [sr,sc]=selected;
    if(grid[r][c]===null && canMove(sr,sc,r,c)){
      moveBall(sr,sc,r,c);
      selected=null;
      renderBoard();
      checkMatches(r,c);
    }else{
      selected=null;
      renderBoard();
    }
  }else{
    if(grid[r][c]!==null){
      selected=[r,c];
      cell.firstElementChild?.classList.add('selected');
    }
  }
}
function canMove(sr,sc,tr,tc){
  if(sr===tr && sc===tc) return false;
  const visited=Array.from({length:SIZE},()=>Array(SIZE).fill(false));
  const q=[[sr,sc]];
  visited[sr][sc]=true;
  const dirs=[[-1,0],[1,0],[0,-1],[0,1]];
  while(q.length){
    const [r,c]=q.shift();
    for(const [dr,dc] of dirs){
      const nr=r+dr,nc=c+dc;
      if(nr<0||nc<0||nr>=SIZE||nc>=SIZE) continue;
      if(nr===tr && nc===tc) return true;
      if(grid[nr][nc]===null && !visited[nr][nc]){visited[nr][nc]=true;q.push([nr,nc]);}
    }
  }
  return false;
}
function moveBall(sr,sc,tr,tc){
  grid[tr][tc]=grid[sr][sc];
  grid[sr][sc]=null;
}
function checkMatches(lastR,lastC){
  animating=true;
  let removed = new Set();
  if(mode==='classic'){
    const dirs=[[0,1],[1,0],[1,1],[1,-1]];
    for(const [dr,dc] of dirs){
      const line = [];
      for(let d=-(MIN_LINE-1);d<=MIN_LINE-1;d++){
        const r=lastR+dr*d,c=lastC+dc*d;
        if(r<0||c<0||r>=SIZE||c>=SIZE) continue;
        if(grid[r][c]===grid[lastR][lastC]) line.push([r,c]);
        else{
          if(line.length>=MIN_LINE) line.forEach(p=>removed.add(p.join(',')));
          line.length=0;
        }
      }
      if(line.length>=MIN_LINE) line.forEach(p=>removed.add(p.join(',')));
    }
  }else{
    const color = grid[lastR][lastC];
    for(let r=0;r<SIZE;r++){
      for(let c=0;c<SIZE;c++){
        if(grid[r][c]===color){
          if(r+1<SIZE && c+1<SIZE){
            if(grid[r+1][c]===color && grid[r][c+1]===color && grid[r+1][c+1]===color){
              [[r,c],[r+1,c],[r,c+1],[r+1,c+1]].forEach(p=>removed.add(p.join(',')));
            }
          }
          if(c+3<SIZE && grid[r][c+1]===color && grid[r][c+2]===color && grid[r][c+3]===color){
            [[r,c],[r,c+1],[r,c+2],[r,c+3]].forEach(p=>removed.add(p.join(',')));
          }
          if(r+3<SIZE && grid[r+1][c]===color && grid[r+2][c]===color && grid[r+3][c]===color){
            [[r,c],[r+1,c],[r+2,c],[r+3,c]].forEach(p=>removed.add(p.join(',')));
          }
        }
      }
    }
  }
  if(removed.size){
    score += removed.size;
    scoreEl.textContent=score;
    removed.forEach(s=>{
      const [r,c]=s.split(',').map(Number);
      grid[r][c]=null;
    });
    setTimeout(()=>{renderBoard(); animating=false; addBalls();},350);
  }else{
    setTimeout(()=>{addBalls(); renderBoard(); animating=false;},350);
  }
}
function gameOver(){
  saveScore(score);
  setTimeout(()=>alert('Game Over! Score: '+score),10);
  newGame();
}
function newGame(){
  initBoard();
  score=0;
  selected=null;
  addBalls();
  renderBoard();
  scoreEl.textContent=0;
}
function setMode(m){
  mode=m;
  document.getElementById('classicBtn').classList.toggle('active',mode==='classic');
  document.getElementById('squareBtn').classList.toggle('active',mode==='squares');
  newGame();
}
</script>
</body>
</html>
